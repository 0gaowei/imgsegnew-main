# 图分割接口说明书

## 1 文档概述

本文档描述了图分割系统的所有API接口规范，包括`SAM图像分割`、`ResNet组件分类`、`OCR文字识别`、`模型训练`等功能的接口定义。

### 1.1 基本信息

- **服务地址**: http://43.247.90.210:9002
- **API版本**: v1
- **基础路径**: /imgSeg/v1/

### 1.2 接口规范

- **请求方式**: POST (除特殊说明外)
- **数据格式**: JSON
- **字符编码**: UTF-8
- **认证方式**: 无需认证

### 1.3 响应格式

所有接口响应均遵循统一格式：

```json
{
  "code": 100,
  "status": 200,
  "message": "成功",
  "payload": {
    // 具体响应数据
  }
}
```

- `code`: 业务状态码，100表示成功，负数表示失败
- `status`: HTTP状态码
- `message`: 响应描述
- `payload`: 具体业务数据

## 2 接口列表

### 2.1 入料识别接口（3个接口）

#### 2.1.1 获取上传的文件
- **接口名称**: serve_upload
- **请求路径**: `/uploads/{filename}`
- **请求方式**: GET
- **功能描述**: 获取通过 ingest 接口上传的文件，支持图片回显

#### 2.1.2 入料并识别（同步MVP）
- **接口名称**: ingest
- **请求路径**: `/ingest`
- **请求方式**: POST (multipart/form-data)
- **功能描述**: 上传图片或指定图片URL，执行 SAM 自动分割 + ResNet 组件分类，返回 componentsMap 与 componentsTree

#### 2.1.3 查询 ingest 任务状态
- **接口名称**: ingest_status
- **请求路径**: `/ingest/status`
- **请求方式**: GET
- **功能描述**: 查询 ingest 异步任务的执行状态和结果

### 2.2 SAM推理接口（3个接口）

#### 2.2.1 SAM推理
- **接口名称**: predictSam
- **请求路径**: `/imgSeg/v1/predictSam`
- **功能描述**: 获取图像用SAM推理分割，支持点选、框选等提示方式

#### 2.2.2 SAM自动分割和点分割推理
- **接口名称**: predictSam2
- **请求路径**: `/imgSeg/v1/predictSam2`
- **功能描述**: 针对SAM自动分割生成图片过多的问题进行了优化，实现了过滤功能并支持点提示分割

#### 2.2.3 套索SAM推理
- **接口名称**: predictSam3
- **请求路径**: `/imgSeg/v1/predictSam3`
- **功能描述**: 前端使用套索选择区域，后端处理后使用SAM框选分割功能进行推理

### 2.3 ResNet推理接口（1个接口）

#### 2.2.1 ResNet推理
- **接口名称**: predictResnet
- **请求路径**: `/imgSeg/v1/predictResnet`
- **功能描述**: 获取图像用ResNet推理图像组件类型，支持批量处理

### 2.4 OCR文字识别接口（1个接口）

#### 2.4.1 OCR文字识别
- **接口名称**: predictText
- **请求路径**: `/imgSeg/v1/predictText`
- **功能描述**: 开始OCR文字识别推理，提取图片中的文字内容和位置信息

### 2.5 训练相关接口（4个接口）

#### 2.4.1 训练资源增加
- **接口名称**: getTrainData
- **请求路径**: `/imgSeg/v1/getTrainData`
- **功能描述**: 将训练数据添加进指定文件夹下，支持批量上传训练样本

#### 2.4.2 训练任务开始
- **接口名称**: resnetTrainStart
- **请求路径**: `/imgSeg/v1/resnetTrainStart`
- **功能描述**: 训练ResNet模型任务开始，支持自定义训练参数

#### 2.4.3 训练任务进度查询
- **接口名称**: resnetTrainProgress
- **请求路径**: `/imgSeg/v1/resnetTrainProgress`
- **功能描述**: 查看训练任务进度，包含准确率、损失等详细训练信息

#### 2.4.4 训练任务终止
- **接口名称**: resnetTrainSkip
- **请求路径**: `/imgSeg/v1/resnetTrainSkip`
- **功能描述**: 训练任务终止，支持手动停止训练任务

## 3 错误码说明

| 错误码 | 含义 |
|--------|------|
| 601 | url图片数据不合规（宽高超过740分辨率或小于30分辨率） |
| 602 | component_type不合规（训练数据集中没有此component_type名称） |
| 603 | url图片数据和component_type都不合规 |
| 800 | 当前有训练任务正在进行，创建训练任务失败 |
| 801 | 读取url图像数据失败 |
| 802 | 超时 |
| 803 | 任务ID不存在 |
| 804 | 用户ID不存在 |
| 805 | 模型ID输入错误 (ResNet模型id) |
| 806 | 数据格式错误 如输入prompt格式有误 |
| 807 | 参数不合法 |
| 808 | 未知异常 |
| 900 | 单条数据新增成功 |
| 901 | 单条数据url或component_type键名称错误 |
| 902 | 单条数据url图像读取失败 |

## 文档修订记录

| 修订版本号 | 修订人 | 修订日期 | 修订描述 |
|-----------|--------|----------|----------|
| v1.2 | 陈家伟 | 2026-01-26 | 补充生成组件列表 api |
| v1.1 | gaowei | 2026-01-22 | 补充文档：SAM 接口流程图与示例，加入环境迁移说明 |
| v1.0 | 陈家伟 | 2026-01-21 | 整理所有API接口规范 |

---

**文档版本**: v1.2
**最后更新**: 2026-01-26
**对应系统版本**: 图分割系统
